# Frontend (Next.js) — UX Spec (Chat MVP)

## 1. Layout
Interfaz tipo ChatGPT:

- Sidebar izquierda:
  - “Nuevo Chat”
  - “Análisis DICOM”
  - lista de chats
- Panel principal:
  - header: Upload + Plan Toggle
  - body: mensajes
  - footer: input enviar

---

## 2. Plan BASIC vs PRO (reglas)
### BASIC
- Puede chatear y recibir respuestas en streaming.
- NO puede subir archivos.
- UX:
  - botón “Cargar archivos” disabled + tooltip “Disponible solo en Pro”.

### PRO
- Todo lo de BASIC.
- Upload habilitado.

Persistencia:
- El plan se conserva al refrescar por `zustand persist` (key `plan-storage`).

---

## 3. Comportamiento del upload (PRO)
Flujo UX:
1) Usuario elige archivo
2) Status: “Solicitando permiso de carga...”
3) Status: “Subiendo a Blob...”
4) Status: “Confirmando metadata...”
5) Status final: “Listo. Archivo cargado.”

Errores:
- Si falla el SAS, el PUT o el commit:
  - muestra `Error: <mensaje>` (status)
  - el chat sigue usable

Reglas de habilitación:
- disabled si:
  - `plan === "BASIC"` OR `activeChatId == null`

---

## 4. Persistencia al refrescar
Persistencia real:
- Chats, mensajes y attachments persisten en Postgres vía backend.
- El frontend “reconstruye” el estado consultando APIs.

Persistencia del plan:
- `plan` persiste en localStorage con `plan-storage`

Recomendación opcional (MVP+):
- Persistir `activeChatId` en localStorage para reabrir el último chat tras refresh.

---

## 5. Streaming de mensajes (SSE)
UX esperado:
1) Usuario envía mensaje
2) Mensaje del usuario aparece inmediatamente (optimistic)
3) Aparece un mensaje del assistant vacío (placeholder)
4) La respuesta del assistant se construye incrementalmente con deltas

Implementación:
- `appendToLastAssistant(delta)` concatena al último mensaje si es assistant.

Recomendación UX (MVP+):
- deshabilitar botón enviar mientras hay stream activo
- botón “Stop generating”

---

## 6. DICOM
Estado actual:
- Solo UI (botón y potencial creación de chat tipo DICOM)
- Sin procesamiento real todavía

Documentación del producto:
- DICOM pipeline se implementa en fase posterior.

